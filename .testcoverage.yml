# Test coverage configuration for go-test-coverage
# https://github.com/vladopajic/go-test-coverage

# Coverage profile generated by go test
profile: coverage.out

# Default thresholds
threshold:
  file: 0           # No per-file threshold
  package: 85       # 85% coverage required per package
  total: 75         # 75% overall project coverage (current: ~77%)

# Package-specific overrides
override:
  # internal/api has lower threshold after oapi-codegen migration (PR #164)
  # The StrictServer has many error paths not exercised by existing tests.
  # v0.7 added many new endpoints (notes, associations, LDS ordinances, etc.)
  # TODO: Add error path tests in follow-up PR to restore 85% threshold.
  - threshold: 60
    path: ^internal/api$

  # internal/gedcom has complex import/export code requiring GEDCOM test fixtures
  # v0.7 milestone added LDS ordinance, association, note imports which need test files
  # TODO: Add GEDCOM round-trip tests in follow-up PR
  - threshold: 75
    path: ^internal/gedcom$

  # internal/command at 82.6% after v0.7 - close to 85%, needs error path tests
  # TODO: Improve coverage in follow-up PR
  - threshold: 80
    path: ^internal/command$

  # internal/repository infrastructure code (interfaces, eventstore)
  # Lower threshold as it contains mainly interface definitions
  - threshold: 65
    path: ^internal/repository$

  # internal/repository/memory is test/demo implementation, lower priority
  - threshold: 65
    path: ^internal/repository/memory$

# Exclude packages from coverage checks
exclude:
  paths:
    - cmd/myfamily                   # main entry point, mostly wiring code
    - internal/web                   # static file embedding (build-tag dependent)
    - internal/repository/postgres   # integration tests require Docker
    - internal/repository/sqlite     # sqlite requires complex setup
    - generated\.go$                 # generated code from oapi-codegen
